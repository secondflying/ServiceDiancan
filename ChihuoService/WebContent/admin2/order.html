<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>智能点餐管理系统</title>

<!-- Le styles -->
<link href="css/flexgrid/flexigrid.css" rel="stylesheet" />

</head>

<body>
	<div id="top"></div>
	<table id="flex1" style="display: none"></table>

	<script src="js/jquery-1.7.2.min.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="js/jquery.confirm-1.3.js"></script>
	<script src="js/flexigrid.js"></script>

	<script src="js/rest.js"></script>
	<script>
		function preProcess(json) {
			console.log(json);
			json.page = 1;
			json.total = 1;
			$.each(json, function(index, value) {
				if (!isNaN(index)) {
					json.total++;
					var obj = {};
					obj.id = value.id;
					obj.cell = {};
					
					obj.cell.id = value.id;
					obj.cell.deskname = value.desk.name;
					obj.cell.peoplenumber = value.number;
					obj.cell.starttime = value.starttime;
					obj.cell.waitername = value.waiter.username;
					obj.cell.price = 0;
					
					$.each(value.orderItems, function(index2, value2) {
						obj.cell.price += value2.recipe.price * value2.count;
					});
					
					obj.cell.statusShow = (value.status && value.status == 1) ? '已开台':'结账请求';
					obj.cell.tool = "<button class='xiangqing' value='" + value.id + "'>详情</button><button class='jiezhang' value='" + value.id + "'>结账</button></button><button class='chedan' value='" + value.id + "'>撤单</button>";
					json.rows.push(obj);
				}
			});
			return json;
		}
		
		function onSuccess(obj){
			//删除
			$('button.send').click(function() {
				//alert($(this).attr("value"));
				var usernmae = $(this).attr("value");
				$.post('../rest/notification/' + usernmae, function(data) {});
				
				return false;
			});
		}

		$(document).ready(function() {
			$("#flex1").flexigrid({
				url : '../rest/orders?status=1',
				method : 'GET',
				dataType : 'json',
				colModel : [
								{display : '订单编号',name : 'id',width : 100,sortable : false,align : 'center'}, 
								{display : '桌号',name : 'deskname',width : 100,sortable : false,align : 'center'}, 
								{display : '就餐人数',name : 'peoplenumber',width : 100,sortable : false,align : 'center'},
								{display : '开台时间',name : 'starttime',width : 150,sortable : false,align : 'center'}, 
								{display : '服务员',name : 'waitername',width : 220,sortable : false,align : 'center'}, 
								{display : '价钱',name : 'price',width : 100,sortable : false,align : 'center'}, 
								{display : '状态',name : 'statusShow',width : 80,sortable : false,align : 'center'},
								{display : '操作',name : 'tool',width : 100,sortable : false,align : 'center'} 
							],
				buttons : [ 
					            {name : '发送在线用户',bclass : 'add'}, 
								{separator : true} 
						  ],
				preProcess : preProcess,
				onSuccess : onSuccess,
				title : '未结订单',
				usepager : false,
				showTableToggleBtn : false,
				width : 1200,
				height : 400
			});

		}); 
	</script>
</body>
</html>
